\usepackage{ % Multilingual support
  fontspec, % Custom fonts
  xunicode, % Unicode support in XeLaTeX. If you encounter problems while typesetting, clear the font cache in TexLive folder.
  etoolbox} % Magic patches to commands
\usepackage{ % Other packages
  graphicx, % Support the \includegraphics command and options
  listings} % Adds environment for code linting and blocks

% Ignore oversize errors
\tolerance = 500000
\hbadness = 500000
\vbadness = 500000


% Several tweaks
\ProcessOptionsBeamer % Beamer styles
\setbeamertemplate{navigation symbols}{} % Disable navigation symbols

% Setting base styles for further modifications
\useoutertheme[
  footline = authorinstitutetitle, % Author, Institute and Title
  subsection = false] % Do not show lower level tiles
  {miniframes} % The likely navigation bars
\useinnertheme{rectangles}
\usecolortheme{whale}
\usecolortheme{orchid}

% Patching miniframe titles for dots to appear on the sides of the subsection titles instead of below
% Patch comes from http://tex.stackexchange.com/questions/88182/beamer-miniframes-side-by-side-section-names-and-navigation-dots
\makeatletter
\patchcmd{\slideentry}{\advance\beamer@tempdim by -.05cm}{\advance\beamer@tempdim by\beamer@vboxoffset\advance\beamer@tempdim by\beamer@boxsize\advance\beamer@tempdim by 1.2\pgflinewidth}{}{}
\patchcmd{\slideentry}{\kern\beamer@tempdim}{\advance\beamer@tempdim by 2pt\advance\beamer@tempdim by\wd\beamer@sectionbox\kern\beamer@tempdim}{}{}
\makeatother

% Defining colours
\xdefinecolor{basecolour}{rgb} % Default colour, this can be changed
  {0.455, 0.204, 0.506} % THU purple
\setbeamercolor{frametitle}{ % Frame title colour
  fg = white, % Foreground colour
  bg = basecolour} % Background colour
\setbeamercolor{title}{
  fg = white, % Foreground colour
  bg = basecolour} % Background colour
\setbeamerfont{frametitle}{
  size = \large} % Default frame title font size
\setbeamercolor{block title}{
  bg = basecolour}
\setbeamercolor{block title example}{
  use = {
    normal text,
    example text},
  fg = example text.fg!75!normal text.fg,
  bg = basecolour text.bg!75!black}
\setbeamercolor{fine separation line}{}
\setbeamercolor{item projected}{
  fg = black}
\setbeamercolor{palette sidebar primary}{
  use = normal text,
  fg = normal text.fg}
\setbeamercolor{palette sidebar quaternary}{
  use = structure,
  fg = structure.fg}
\setbeamercolor{palette sidebar secondary}{
  use = structure,
  fg = structure.fg}
\setbeamercolor{palette sidebar tertiary}{
  use = normal text,
  fg = normal text.fg}
\setbeamercolor{section in sidebar}{
  fg = brown}
\setbeamercolor{section in sidebar shaded}{
  fg = grey}
\setbeamercolor{separation line}{}
\setbeamercolor{sidebar}{
  bg = basecolour}
\setbeamercolor{sidebar}{
  parent = palette primary}
\setbeamercolor{structure}{
  fg = basecolour}
\setbeamercolor{subsection in sidebar}{
  fg = brown}
\setbeamercolor{subsection in sidebar shaded}{
  fg = grey}

% Creating a new frame context
\newenvironment{lpqframe}
{ % begin of context init
  \begin{frame}[
    allowframebreaks]%
  \frametitle{\secname\ |\ \subsecname\ }%
} % end of context init
{ % begin of context term
  \end{frame}%
} % end of context term

% Creating a header / footer system
\newenvironment{lpqcontext}
{ % begin of context init
  % Title page
  \begin{frame}
    \bigskip
    \titlepage
  \end{frame}
  % Table of Contents
  \section*{Table of Contents}
  \begin{frame}
    \frametitle{Table of Contents}
    \tableofcontents
  \end{frame}
} % end of context init
{ % begin of context term
} % end of context term
